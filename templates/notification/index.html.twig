{% extends 'base.html.twig' %}

{% block title %}Mes notifications{% endblock %}

{% block stylesheets %}
    {{ parent() }}
    <style>
        /* Main layout */
        main {
            background: #ffffff !important;
        }

        .notifications-container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 2rem 1.5rem;
        }

        /* Header Section */
        .notifications-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 3rem 2rem;
            border-radius: 12px;
            margin-bottom: 3rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1), 0 10px 20px rgba(0, 0, 0, 0.06);
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 2rem;
            flex-wrap: wrap;
        }

        .notifications-header-left h1 {
            margin: 0;
            font-size: 2.75rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 1rem;
            letter-spacing: -0.5px;
        }

        .notifications-header-left p {
            margin: 0.5rem 0 0 0;
            font-size: 1.05rem;
            opacity: 0.95;
            font-weight: 400;
        }

        .notifications-count {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            background: rgba(255, 255, 255, 0.25);
            border-radius: 8px;
            padding: 0.5rem 1rem;
            font-size: 1.5rem;
            font-weight: 700;
            backdrop-filter: blur(10px);
        }

        .btn-mark-all {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            padding: 0.75rem 1.5rem;
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 0.95rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn-mark-all:hover {
            background: rgba(255, 255, 255, 0.3);
            border-color: rgba(255, 255, 255, 0.5);
        }

        /* Notifications List */
        .notifications-list {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .notification-item {
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 12px;
            padding: 1.5rem;
            display: flex;
            gap: 1.5rem;
            align-items: flex-start;
            transition: all 0.3s ease;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }

        .notification-item:hover {
            box-shadow: 0 8px 16px rgba(102, 126, 234, 0.1);
            border-color: #667eea;
            transform: translateY(-2px);
        }

        .notification-item.unread {
            background: linear-gradient(135deg, #eef2ff 0%, #f5f3ff 100%);
            border-color: #667eea;
        }

        .notification-icon {
            font-size: 2rem;
            flex-shrink: 0;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 10px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .notification-icon.wishlist {
            background: linear-gradient(135deg, #ec4899 0%, #f43f5e 100%);
        }

        .notification-icon.restock {
            background: linear-gradient(135deg, #10b981 0%, #34d399 100%);
        }

        .notification-icon.order {
            background: linear-gradient(135deg, #f59e0b 0%, #fbbf24 100%);
        }

        .notification-icon.stock {
            background: linear-gradient(135deg, #ef4444 0%, #f87171 100%);
        }

        .notification-icon.new-book {
            background: linear-gradient(135deg, #8b5cf6 0%, #a78bfa 100%);
        }

        .notification-content {
            flex: 1;
        }

        .notification-message {
            font-size: 1.05rem;
            color: #1f2937;
            font-weight: 500;
            margin-bottom: 0.75rem;
            line-height: 1.5;
        }

        .notification-meta {
            display: flex;
            align-items: center;
            gap: 1rem;
            flex-wrap: wrap;
            font-size: 0.85rem;
        }

        .notification-time {
            color: #6b7280;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 0.375rem;
        }

        .badge-unread {
            display: inline-flex;
            align-items: center;
            gap: 0.375rem;
            padding: 0.375rem 0.875rem;
            background: #fee2e2;
            color: #dc2626;
            border-radius: 6px;
            font-size: 0.75rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .notification-actions {
            display: flex;
            gap: 0.75rem;
            align-items: center;
            flex-shrink: 0;
        }

        .btn-mark-read {
            background: #667eea;
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            font-size: 0.8rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 0.375rem;
            white-space: nowrap;
        }

        .btn-mark-read:hover {
            background: #5a67d8;
            box-shadow: 0 4px 8px rgba(102, 126, 234, 0.2);
        }

        .btn-delete {
            background: #ef4444;
            color: white;
            border: none;
            padding: 0.5rem 0.875rem;
            border-radius: 6px;
            font-size: 0.8rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 0.375rem;
        }

        .btn-delete:hover {
            background: #dc2626;
            box-shadow: 0 4px 8px rgba(239, 68, 68, 0.2);
        }

        .btn-delete-all {
            background: #f59e0b;
            color: white;
            padding: 0.75rem 1.5rem;
            border: 1px solid #f59e0b;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 0.95rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn-delete-all:hover {
            background: #d97706;
            border-color: #d97706;
            box-shadow: 0 4px 8px rgba(217, 119, 6, 0.2);
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 5rem 2rem;
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 12px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }

        .empty-state-icon {
            font-size: 4rem;
            color: #d1d5db;
            margin-bottom: 1.5rem;
        }

        .empty-state h3 {
            color: #1f2937;
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 0.75rem;
        }

        .empty-state p {
            color: #6b7280;
            font-size: 1rem;
            margin-bottom: 2rem;
        }

        .btn-primary-custom {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 0.875rem 2rem;
            border-radius: 8px;
            text-decoration: none;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 0.65rem;
            transition: all 0.3s ease;
            border: none;
            cursor: pointer;
            font-size: 0.95rem;
        }

        .btn-primary-custom:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 16px rgba(102, 126, 234, 0.3);
        }

        /* Responsive */
        @media (max-width: 768px) {
            .notifications-header {
                flex-direction: column;
                align-items: stretch;
                text-align: center;
                padding: 2rem 1.5rem;
            }

            .notifications-header-left h1 {
                font-size: 2rem;
                justify-content: center;
            }

            .notifications-header-left p {
                text-align: center;
            }

            .btn-mark-all {
                width: 100%;
                justify-content: center;
            }

            .notification-item {
                flex-direction: column;
                gap: 1rem;
            }

            .notification-actions {
                width: 100%;
                justify-content: flex-start;
            }

            .btn-mark-read {
                flex: 1;
                justify-content: center;
            }
        }

        @media (max-width: 480px) {
            .notifications-container {
                padding: 1rem 1rem;
            }

            .notifications-header {
                padding: 1.5rem 1rem;
            }

            .notifications-header-left h1 {
                font-size: 1.5rem;
            }
        }
    </style>
{% endblock %}

{% block body %}
<div class="notifications-container">
    <div class="notifications-header">
        <div class="notifications-header-left">
            <h1>
                <i class="bi bi-bell-fill"></i>
                Mes notifications
            </h1>
            <p>Restez informé de vos activités</p>
        </div>
        {% set unread = notifications|filter(n => not n.isRead)|length %}
        <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
            {% if unread > 0 %}
                <form method="POST" action="{{ path('notifications_mark_all_read') }}">
                    <button type="submit" class="btn-mark-all">
                        <i class="bi bi-check-all"></i>
                        Tout marquer comme lu <span class="notifications-count">{{ unread }}</span>
                    </button>
                </form>
            {% endif %}
            {% if notifications|length > 0 %}
                <form method="POST" action="{{ path('notifications_delete_all') }}" style="display: inline;" onsubmit="return confirm('Êtes-vous sûr de vouloir supprimer toutes les notifications ?');">
                    <button type="submit" class="btn-delete-all">
                        <i class="bi bi-trash"></i>
                        Supprimer tout
                    </button>
                </form>
            {% endif %}
        </div>
    </div>

    {% if notifications is empty %}
        <div class="empty-state">
            <div class="empty-state-icon">
                <i class="bi bi-inbox"></i>
            </div>
            <h3>Aucune notification</h3>
            <p>Vous n'avez aucune notification pour le moment. Continuez vos achats et restez informé de vos activités!</p>
            <a href="{{ path('app_livre_index') }}" class="btn-primary-custom">
                <i class="bi bi-book"></i> Explorer le catalogue
            </a>
        </div>
    {% else %}
        <div class="notifications-list">
            {% for notification in notifications %}
                <div class="notification-item {% if not notification.isRead %}unread{% endif %}">
                    <div class="notification-icon {% if notification.type == 'wishlist_add' or notification.type == 'wishlist_restock' %}wishlist{% elseif notification.type == 'stock_out' %}stock{% elseif notification.type == 'new_book' %}new-book{% elseif notification.type starts with 'order' %}order{% endif %}">
                        {% if notification.type == 'wishlist_add' %}
                            <i class="bi bi-heart-fill"></i>
                        {% elseif notification.type == 'wishlist_restock' or notification.type == 'stock_out' %}
                            <i class="bi bi-arrow-repeat"></i>
                        {% elseif notification.type == 'new_book' %}
                            <i class="bi bi-book"></i>
                        {% elseif notification.type starts with 'order' %}
                            <i class="bi bi-package"></i>
                        {% else %}
                            <i class="bi bi-info-circle"></i>
                        {% endif %}
                    </div>
                    <div class="notification-content">
                        <div class="notification-message">{{ notification.message }}</div>
                        <div class="notification-meta">
                            <span class="notification-time">
                                <i class="bi bi-clock"></i>
                                {{ notification.createdAt|date('d/m/Y H:i') }}
                            </span>
                            {% if not notification.isRead %}
                                <span class="badge-unread">
                                    <i class="bi bi-circle-fill"></i>
                                    Non lu
                                </span>
                            {% endif %}
                        </div>
                    </div>
                    {% if not notification.isRead %}
                        <div class="notification-actions">
                            <form method="POST" action="{{ path('notifications_mark_read', {'id': notification.id}) }}" style="display: contents;">
                                <button type="submit" class="btn-mark-read">
                                    <i class="bi bi-check"></i>
                                    Marquer comme lu
                                </button>
                            </form>
                            <form method="POST" action="{{ path('notifications_delete', {'id': notification.id}) }}" style="display: contents;" onsubmit="return confirm('Supprimer cette notification ?');">
                                <button type="submit" class="btn-delete">
                                    <i class="bi bi-trash"></i>
                                    Supprimer
                                </button>
                            </form>
                        </div>
                    {% else %}
                        <div class="notification-actions">
                            <form method="POST" action="{{ path('notifications_delete', {'id': notification.id}) }}" style="display: contents;" onsubmit="return confirm('Supprimer cette notification ?');">
                                <button type="submit" class="btn-delete">
                                    <i class="bi bi-trash"></i>
                                    Supprimer
                                </button>
                            </form>
                        </div>
                    {% endif %}
                </div>
            {% endfor %}
        </div>
    {% endif %}
</div>
{% endblock %}


