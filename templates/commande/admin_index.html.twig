{% extends 'base.html.twig' %}

{% block title %}Gestion des commandes{% endblock %}

{% block stylesheets %}
    {{ parent() }}
    <style>
        .admin-orders-container {
            max-width: 1100px;
            margin: 2rem auto;
            padding: 0 1.5rem;
        }

        .admin-orders-header {
            margin-bottom: 1.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .admin-orders-header h1 {
            font-size: 1.5rem;
            font-weight: 600;
            margin: 0;
        }

        table.admin-orders-table {
            width: 100%;
            border-collapse: collapse;
            background: #ffffff;
            border-radius: 6px;
            overflow: hidden;
            border: 1px solid #e5e7eb;
            font-size: 0.875rem;
        }

        table.admin-orders-table th,
        table.admin-orders-table td {
            padding: 0.6rem 0.75rem;
            border-bottom: 1px solid #e5e7eb;
            text-align: left;
        }

        table.admin-orders-table th {
            background: #f9fafb;
            font-weight: 600;
            color: #4b5563;
        }

        .order-status-badge {
            display: inline-flex;
            align-items: center;
            gap: 0.35rem;
            padding: 0.25rem 0.6rem;
            border-radius: 999px;
            font-size: 0.75rem;
        }

        .status-en_attente { background-color: #fef3c7; color: #92400e; }
        .status-validee   { background-color: #dcfce7; color: #166534; }
        .status-expediee  { background-color: #e0f2fe; color: #075985; }
        .status-livree    { background-color: #e5e7eb; color: #374151; }
        .status-annulee   { background-color: #fee2e2; color: #b91c1c; }

        .status-form select {
            font-size: 0.75rem;
            padding: 0.25rem 0.4rem;
        }

        .status-form button {
            font-size: 0.75rem;
            padding: 0.25rem 0.5rem;
        }
    </style>
{% endblock %}

{% block body %}
<div class="admin-orders-container">
    <div class="admin-orders-header">
        <h1>Gestion des commandes</h1>
    </div>

    {% for message in app.flashes('success') %}
        <div class="alert alert-success">{{ message }}</div>
    {% endfor %}
    {% for message in app.flashes('error') %}
        <div class="alert alert-danger">{{ message }}</div>
    {% endfor %}

    {% if commandes is not empty %}
        <table class="admin-orders-table">
            <thead>
                <tr>
                    <th>#</th>
                    <th>Utilisateur</th>
                    <th>Date</th>
                    <th>Total</th>
                    <th>Statut</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for commande in commandes %}
                    <tr>
                        <td>#{{ commande.id }}</td>
                        <td>{{ commande.user.userIdentifier }}</td>
                        <td>{{ commande.createdAt ? commande.createdAt|date('d/m/Y H:i') : '' }}</td>
                        <td>{{ commande.total|number_format(2, ',', ' ') }} €</td>
                        <td>
                            <span class="order-status-badge status-{{ commande.statut }}">
                                {{ commande.statut|replace({
                                    'en_attente': 'En attente',
                                    'validee': 'Validée',
                                    'expediee': 'Expédiée',
                                    'livree': 'Livrée',
                                    'annulee': 'Annulée'
                                }) }}
                            </span>
                        </td>
                        <td>
                            <form method="POST"
                                  action="{{ path('admin_commandes_change_statut', {'id': commande.id}) }}"
                                  class="status-form d-inline-flex align-items-center gap-1">
                                <input type="hidden" name="_token" value="{{ csrf_token('change_statut_' ~ commande.id) }}">
                                <select name="statut" class="form-select form-select-sm">
                                    <option value="en_attente"  {{ commande.statut == 'en_attente' ? 'selected' : '' }}>En attente</option>
                                    <option value="validee"     {{ commande.statut == 'validee' ? 'selected' : '' }}>Validée</option>
                                    <option value="expediee"    {{ commande.statut == 'expediee' ? 'selected' : '' }}>Expédiée</option>
                                    <option value="livree"      {{ commande.statut == 'livree' ? 'selected' : '' }}>Livrée</option>
                                    <option value="annulee"     {{ commande.statut == 'annulee' ? 'selected' : '' }}>Annulée</option>
                                </select>
                                <button type="submit" class="btn btn-sm btn-outline-primary">OK</button>
                            </form>
                        </td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    {% else %}
        <div class="alert alert-info">
            Aucune commande enregistrée pour le moment.
        </div>
    {% endif %}
</div>
{% endblock %}


